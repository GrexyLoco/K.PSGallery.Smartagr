name: ðŸš€ PowerShell Module Release Pipeline

# ðŸŽ¯ Triggers
# - Push to master/main branch (e.g., PR merge)
# - Manual dispatch with optional version override
on:
  push:
    branches: [master, main]
  workflow_dispatch:
    inputs:
      version:
        description: 'ðŸ“Œ Override version (e.g., 1.2.3, leave empty for auto-detection)'
        required: false
        type: string
        default: ''
      enable-psgallery-notification:
        description: 'ðŸ“£ Enable notification to K.PSGallery pipeline (true/false)'
        required: false
        type: boolean
        default: true

env:
  # ðŸŒ Global Configuration
  RELEASE_AUTHOR: "github-actions[bot]"
  RELEASE_EMAIL: "github-actions[bot]@users.noreply.github.com"
  UBUNTU_VERSION: ${{ vars.UBUNTU_VERSION || 'ubuntu-24.04' }}
  # ðŸ“¦ Module Configuration
  MODULE_NAME: ${{ vars.MODULE_NAME || 'K.PSGallery.Smartagr' }}
  TARGET_REPOSITORY: ${{ vars.TARGET_REPOSITORY || 'GrexyLoco/K.PSGallery' }}
  # ðŸ“£ PSGallery notification: Input > Environment Variable > Default (true)
  ENABLE_PSGALLERY_NOTIFICATION: ${{ github.event.inputs.enable-psgallery-notification || vars.ENABLE_PSGALLERY_NOTIFICATION || 'true' }}

jobs:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ” JOB 1: QUALITY GATE - Security & Tests
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  quality-gate:
    name: ðŸ” Security & ðŸ§ª Tests
    runs-on: ${{ vars.UBUNTU_VERSION || 'ubuntu-24.04' }}
    outputs:
      test-success: ${{ steps.validation.outputs.test-success }}
      total-tests: ${{ steps.validation.outputs.total-tests }}
      passed-tests: ${{ steps.validation.outputs.passed-tests }}
      failed-tests: ${{ steps.validation.outputs.failed-tests }}
      skipped-tests: ${{ steps.validation.outputs.skipped-tests }}
      test-duration: ${{ steps.validation.outputs.test-duration }}
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ§ª Validate PowerShell Module
        id: validation
        uses: GrexyLoco/K.Actions.PSModuleValidation@v1
        with:
          test-path: "./Tests"
          output-path: "./TestResults.xml"
          validate-all-codebase: "false"
          github-token: ${{ secrets.GITHUB_TOKEN }}
          module-name: ${{ env.MODULE_NAME }}

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ“¦ JOB 2: PREPARE RELEASE - Version Management & PSD1 Update
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  prepare-release:
    name: ðŸ“¦ Prepare Release
    needs: quality-gate
    if: needs.quality-gate.outputs.test-success == 'true'
    runs-on: ${{ vars.UBUNTU_VERSION || 'ubuntu-24.04' }}
    outputs:
      new-version: ${{ steps.determine-version.outputs.final-version }}
      bump-type: ${{ steps.next-version.outputs.bumpType }}
      should-release: ${{ steps.determine-version.outputs.should-release }}
      current-version: ${{ steps.next-version.outputs.currentVersion }}
      last-release-tag: ${{ steps.next-version.outputs.lastReleaseTag }}
    permissions:
      contents: write
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
          persist-credentials: true

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ðŸ”¢ Version Detection: Manual Override vs. Auto-Detection
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: â¬†ï¸ Analyze next version
        id: next-version
        if: github.event.inputs.version == ''
        uses: GrexyLoco/K.Actions.NextVersion@latest
        with:
          manifestPath: './${{ env.MODULE_NAME }}.psd1'
          branchName: ${{ github.ref_name }}
          targetBranch: 'master'

      - name: ðŸ”¢ Determine final version
        id: determine-version
        shell: pwsh
        run: |
          $manualVersion = '${{ github.event.inputs.version }}'
          $autoBumpType = '${{ steps.next-version.outputs.bumpType }}'
          $autoNewVersion = '${{ steps.next-version.outputs.newVersion }}'
          
          if ($manualVersion) {
            $finalVersion = $manualVersion -replace '^v', ''
            $shouldRelease = 'true'
            $bumpType = 'manual'
            Write-Output "ðŸ“Œ Using manual version override: $finalVersion"
          }
          elseif ($autoBumpType -eq 'none' -or -not $autoNewVersion) {
            $finalVersion = ''
            $shouldRelease = 'false'
            $bumpType = 'none'
            Write-Output "â„¹ï¸ No version changes detected"
          }
          else {
            $finalVersion = $autoNewVersion
            $shouldRelease = 'true'
            $bumpType = $autoBumpType
            Write-Output "ðŸ”„ Auto-detected version: $finalVersion ($bumpType)"
          }
          
          "final-version=$finalVersion" >> $env:GITHUB_OUTPUT
          "should-release=$shouldRelease" >> $env:GITHUB_OUTPUT
          "bump-type=$bumpType" >> $env:GITHUB_OUTPUT

      - name: ðŸ›‘ Skip if no changes
        if: steps.determine-version.outputs.should-release == 'false'
        run: |
          echo "## ðŸ” No Release Required" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "â„¹ï¸ No version changes detected - workflow exits gracefully" >> $GITHUB_STEP_SUMMARY

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ðŸ“ Update PSD1 ModuleVersion
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ðŸ“ Update PowerShell Module Version
        if: steps.determine-version.outputs.should-release == 'true'
        shell: pwsh
        run: |
          $manifestPath = './${{ env.MODULE_NAME }}.psd1'
          $newVersion = '${{ steps.determine-version.outputs.final-version }}'
          
          Write-Host "ðŸ”„ Updating manifest version to $newVersion..."
          
          $content = Get-Content $manifestPath -Raw
          $updatedContent = $content -replace "ModuleVersion\s*=\s*'[^']*'", "ModuleVersion = '$newVersion'"
          
          if ($updatedContent -notmatch "ModuleVersion\s*=\s*'$newVersion'") {
            throw "âŒ Manifest update failed!"
          }
          
          Set-Content -Path $manifestPath -Value $updatedContent -NoNewline
          Write-Host "âœ… Manifest updated to version $newVersion"
          
          git config user.name "${{ env.RELEASE_AUTHOR }}"
          git config user.email "${{ env.RELEASE_EMAIL }}"
          
          git add $manifestPath
          git commit -m "chore: bump version to $newVersion [skip ci]"
          git push origin ${{ github.ref_name }}
          
          Write-Host "âœ… Version update committed and pushed"

      - name: ðŸ”„ Re-fetch after version update
        if: steps.determine-version.outputs.should-release == 'true'
        run: |
          git fetch origin ${{ github.ref_name }}
          git reset --hard origin/${{ github.ref_name }}
          echo "âœ… Repository state synchronized"

      - name: ðŸ“ Version Summary
        if: always()
        shell: bash
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          ## ðŸ“¦ Version Calculation
          
          | Property | Value |
          |----------|-------|
          | **Current Version** | `${{ steps.next-version.outputs.currentVersion }}` |
          | **New Version** | `${{ steps.determine-version.outputs.final-version }}` |
          | **Bump Type** | `${{ steps.next-version.outputs.bumpType }}` |
          | **Last Release Tag** | `${{ steps.next-version.outputs.lastReleaseTag }}` |
          | **Should Release** | `${{ steps.determine-version.outputs.should-release }}` |
          
          ---
          EOF

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸš€ JOB 3: GITHUB RELEASE - Smart Tags + GitHub Release via Smartagr
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  github-release:
    name: ðŸš€ GitHub Release
    needs: [quality-gate, prepare-release]
    if: needs.prepare-release.outputs.should-release == 'true'
    runs-on: ${{ vars.UBUNTU_VERSION || 'ubuntu-24.04' }}
    outputs:
      release-created: ${{ steps.smart-release.outputs.release-created }}
      release-url: ${{ steps.smart-release.outputs.release-url }}
      tags-created: ${{ steps.smart-release.outputs.tags-created }}
    permissions:
      contents: write
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
          persist-credentials: true

      - name: ðŸ”„ Sync to latest commit
        run: |
          git fetch origin ${{ github.ref_name }}
          git reset --hard origin/${{ github.ref_name }}

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # ðŸš€ Create Smart Release (Git Tags + GitHub Release)
      #    Uses LOCAL Smartagr module (self-hosting/bootstrap)
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: ðŸš€ Create Smart Release
        id: smart-release
        shell: pwsh
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          git config user.name "${{ env.RELEASE_AUTHOR }}"
          git config user.email "${{ env.RELEASE_EMAIL }}"
          
          # Import LOCAL Smartagr module (self-hosting)
          Write-Output "ðŸ“¦ Importing LOCAL K.PSGallery.Smartagr module..."
          Import-Module "${{ github.workspace }}/${{ env.MODULE_NAME }}.psd1" -Force -Verbose
          
          $targetVersion = "v${{ needs.prepare-release.outputs.new-version }}"
          $bumpType = "${{ needs.prepare-release.outputs.bump-type }}"
          $currentVersion = "${{ needs.prepare-release.outputs.current-version }}"
          
          $releaseNotes = @"
          ## ðŸ“¦ ${{ env.MODULE_NAME }} v${{ needs.prepare-release.outputs.new-version }}
          
          **Bump Type:** $bumpType
          **Previous Version:** $currentVersion
          
          ### ðŸ”„ Changes
          - Automated release via GitHub Actions
          - See commit history for detailed changes
          
          ---
          *Released by [${{ env.MODULE_NAME }}](https://www.powershellgallery.com/packages/${{ env.MODULE_NAME }})*
          "@
          
          $ErrorActionPreference = 'Stop'
          
          try {
            $result = New-SmartRelease `
              -TargetVersion $targetVersion `
              -RepositoryPath "${{ github.workspace }}" `
              -ReleaseNotes $releaseNotes `
              -PushToRemote `
              -Verbose
            
            if ($result.Success) {
              Write-Output "âœ… Smart Release created successfully"
              
              "release-created=true" >> $env:GITHUB_OUTPUT
              "release-url=$($result.ReleaseUrl)" >> $env:GITHUB_OUTPUT
              "tags-created=$($result.TagsCreated -join ',')" >> $env:GITHUB_OUTPUT
              
              $tagsCreatedList = if ($result.TagsCreated.Count -gt 0) { 
                ($result.TagsCreated | ForEach-Object { '`{0}`' -f $_ }) -join ', '
              } else { 
                "_(none)_" 
              }
              
              @"
          ## ðŸš€ Smart Release Created
          
          | Property | Value |
          |----------|-------|
          | **Target Version** | ``$($result.TargetVersion)`` |
          | **Bump Type** | ``$bumpType`` |
          | **Release URL** | [View Release]($($result.ReleaseUrl)) |
          | **Tags Created** | $tagsCreatedList |
          
          ### ðŸ“Š Step Results
          | Step | Status |
          |------|--------|
          | Draft Creation | $($result.StepResults.DraftCreation.Success ? 'âœ…' : 'âŒ') |
          | Tag Creation | $($result.StepResults.TagCreation.Success ? 'âœ…' : 'âŒ') |
          | Release Publication | $($result.StepResults.ReleasePublication.Success ? 'âœ…' : 'âŒ') |
          
          ---
          *Powered by [K.PSGallery.Smartagr](https://www.powershellgallery.com/packages/K.PSGallery.Smartagr)*
          "@ >> $env:GITHUB_STEP_SUMMARY
              
            } else {
              throw "Smart Release failed"
            }
          }
          catch {
            "release-created=false" >> $env:GITHUB_OUTPUT
            throw
          }

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ“¤ JOB 4: PUBLISH TO GITHUB PACKAGES
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  publish-package:
    name: ðŸ“¤ Publish to GitHub Packages
    needs: [quality-gate, prepare-release, github-release]
    if: needs.github-release.outputs.release-created == 'true'
    runs-on: ${{ vars.UBUNTU_VERSION || 'ubuntu-24.04' }}
    permissions:
      packages: write
      contents: read
    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ðŸ”„ Sync to latest commit
        run: |
          git fetch origin ${{ github.ref_name }}
          git reset --hard origin/${{ github.ref_name }}

      - name: ðŸ“¤ Publish to GitHub Packages
        shell: pwsh
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          $moduleName = '${{ env.MODULE_NAME }}'
          $newVersion = '${{ needs.prepare-release.outputs.new-version }}'
          $repoOwner = '${{ github.repository_owner }}'
          
          Write-Output "## ðŸ“¦ Package Publishing" >> $env:GITHUB_STEP_SUMMARY
          Write-Output "" >> $env:GITHUB_STEP_SUMMARY
          Write-Output "| Property | Value |" >> $env:GITHUB_STEP_SUMMARY
          Write-Output "|----------|-------|" >> $env:GITHUB_STEP_SUMMARY
          Write-Output "| **Module** | ``$moduleName`` |" >> $env:GITHUB_STEP_SUMMARY
          Write-Output "| **Version** | ``$newVersion`` |" >> $env:GITHUB_STEP_SUMMARY
          Write-Output "| **Repository** | GitHub Packages |" >> $env:GITHUB_STEP_SUMMARY
          Write-Output "" >> $env:GITHUB_STEP_SUMMARY
          
          $sourceUrl = "https://nuget.pkg.github.com/$repoOwner/index.json"
          
          # Try K.PSGallery.PackageRepoProvider first
          try {
            Install-Module -Name K.PSGallery.PackageRepoProvider -Scope CurrentUser -Force -AllowClobber -ErrorAction Stop
            Import-Module K.PSGallery.PackageRepoProvider -ErrorAction Stop
            
            Write-Output "âœ… Using K.PSGallery.PackageRepoProvider"
            
            Register-PackageRepo `
              -RepoName 'GitHubPackages' `
              -SourceUrl $sourceUrl `
              -PublishUrl "https://nuget.pkg.github.com/$repoOwner" `
              -NugetKey $env:GITHUB_TOKEN
            
            Publish-Package `
              -ModuleName $moduleName `
              -RepoName 'GitHubPackages'
            
            Write-Output "### âœ… Published via PackageRepoProvider" >> $env:GITHUB_STEP_SUMMARY
            "package-published=true" >> $env:GITHUB_OUTPUT
          }
          catch {
            Write-Output "âš ï¸ PackageRepoProvider not available - using Publish-PSResource fallback"
            
            try {
              $repoName = 'GitHubPackages'
              
              Get-PSResourceRepository -Name $repoName -ErrorAction SilentlyContinue | 
                Unregister-PSResourceRepository -ErrorAction SilentlyContinue
              
              Register-PSResourceRepository `
                -Name $repoName `
                -Uri $sourceUrl `
                -Trusted
              
              Publish-PSResource `
                -Path "./$moduleName" `
                -Repository $repoName `
                -ApiKey $env:GITHUB_TOKEN
              
              Write-Output "### âœ… Published via Publish-PSResource (fallback)" >> $env:GITHUB_STEP_SUMMARY
              "package-published=true" >> $env:GITHUB_OUTPUT
            }
            catch {
              Write-Output "### âŒ Package Publishing Failed" >> $env:GITHUB_STEP_SUMMARY
              Write-Output "Error: $($_.Exception.Message)" >> $env:GITHUB_STEP_SUMMARY
              "package-published=false" >> $env:GITHUB_OUTPUT
              throw
            }
          }

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ðŸ“£ JOB 5: NOTIFY K.PSGALLERY PIPELINE
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  notify-psgallery:
    name: ðŸ“£ Notify K.PSGallery
    needs: [quality-gate, prepare-release, github-release, publish-package]
    if: needs.github-release.outputs.release-created == 'true'
    runs-on: ${{ vars.UBUNTU_VERSION || 'ubuntu-24.04' }}
    steps:
      - name: ðŸ“¤ Dispatch to K.PSGallery pipeline
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.REPO_DISPATCH_TOKEN }}
          repository: ${{ env.TARGET_REPOSITORY }}
          event-type: publish_module
          client-payload: |
            {
              "repo": "${{ github.repository }}",
              "tag": "v${{ needs.prepare-release.outputs.new-version }}",
              "bump_type": "${{ needs.prepare-release.outputs.bump-type }}",
              "triggered_by": "${{ github.actor }}",
              "source_url": "https://github.com/${{ github.repository }}",
              "module_name": "${{ env.MODULE_NAME }}",
              "gallery_url": "https://www.powershellgallery.com/packages/${{ env.MODULE_NAME }}/${{ needs.prepare-release.outputs.new-version }}",
              "enable_psgallery_publish": "${{ env.ENABLE_PSGALLERY_NOTIFICATION }}"
            }

      - name: ðŸ“ Dispatch Summary
        shell: bash
        run: |
          cat >> $GITHUB_STEP_SUMMARY << 'EOF'
          ## ðŸ“£ K.PSGallery Pipeline Triggered
          
          | Property | Value |
          |----------|-------|
          | **Module** | `${{ env.MODULE_NAME }}` |
          | **Version** | `v${{ needs.prepare-release.outputs.new-version }}` |
          | **Target Repository** | `${{ env.TARGET_REPOSITORY }}` |
          | **PSGallery Publish** | `${{ env.ENABLE_PSGALLERY_NOTIFICATION }}` |
          
          The K.PSGallery pipeline will handle:
          - ðŸ“¦ Download from GitHub Packages
          - ðŸš€ Publish to PowerShell Gallery
          - ðŸ“£ Release notifications
          
          ---
          EOF
